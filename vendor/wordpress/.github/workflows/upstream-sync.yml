name: Upstream Sync

on:
  workflow_dispatch:
  schedule:
    - cron: "17 4 * * 1" # Mondays

jobs:
  refresh:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Update indices
        run: node shared/scripts/update-upstream-indices.mjs

      - name: Create PR if changed
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "chore: refresh upstream indices"
          title: "chore: refresh upstream indices"
          body: |
            Automated refresh of upstream indices under `shared/references/`.

            - WordPress core versions (from api.wordpress.org)
            - Gutenberg releases (from GitHub Releases API)
            - WordPress â†” Gutenberg mapping (from developer.wordpress.org docs)
          branch: chore/upstream-indices
          delete-branch: true

